!function(r){function t(){"none"!==C&&C.prepend("none"),h.add(f).stop().clearQueue(),u.css("visibility","hidden"),h.fadeTo(500,0,function(){r(this).hide()}),f.fadeTo(200,0).removeClass("cm-box").removeAttr("style").find(m).empty(),r("html").removeClass("overlay-visible")}function o(){f.addClass("cm-box").fadeTo(0,1)}function a(e){objLength=l.length-1,0===e?(v.hide(),w.show(),e===objLength&&w.hide()):e===objLength?(v.show(),w.hide()):v.add(w).show()}function d(e,t){j();var n,i,o,a,d,e=r(l[e]),c=(m.empty(),f.fadeTo(0,0),e.attr("href"));e.is("[rel]")?(m.prepend('<iframe width="640" height="360" frameborder="0" allowfullscreen="" src="'+c+'?autoplay=1;wmode=opaque;showinfo=0;rel=0;"></iframe>'),o=(i=(i=(n=f.find("iframe")).attr("width"))<b?b:i)*y,n.attr({width:i,height:o}),t()):e.is('[href*="#"]')?(location.hash="",C=r(c).parent(),e=r(c).detach(),m.prepend(e),t()):(e.is("[alt]")&&(a=e.attr("alt")),-1<r.inArray(c,s)?u.addClass("cm-loaded"):u.removeClass("cm-loaded"),d=r("<img/>",{src:c,alt:a}),m.prepend(d.on("load",function(){s.push(c);var e=d.height();k<e&&(e=k),d.attr("height",e),t()})))}function n(i){function e(t){var n=x-f.width();f.clearQueue(),"prev"==t?i--:(i++,n*=-1),f.animate({left:n},150,function(){d(i,function(){var e=f.width();n=(x-e)/2+e+60,"prev"==t&&(n*=-1),o(),f.css("left",n).animate({left:0},150,function(){u.addClass("cm-loaded")}),a(i)})})}r("#overlay-mask").length||(r("body").append(h.hide().fadeTo(0,0),u.append(f.append(m),p,v,w,g)),!1==c&&g.tooltip({position:"bottom center",effect:"fade"}),v.on("tap",function(){v.is(":visible")&&e("prev")}),w.on("tap",function(){w.is(":visible")&&e("next")}),u.on("tap",function(e){r(e.target).is(r(f.find("*")).add(v).add(w))&&!r(e.target).is(r(g))||t()})),r("html").addClass("overlay-visible"),a(i),h.show().fadeTo(500,.8,function(){u.css("visibility","visible"),d(i,function(){o()})})}var c="ontouchstart"in window||0<navigator.msMaxTouchPoints,s=[],l=null,h=r("<div/>",{id:"cm-overlay-mask"}),u=r("<div/>",{id:"cm-wrap"}),f=r("<div/>",{id:"cm-overlay"}),m=r("<div/>",{class:"cm-content"}),p=r("<i/>",{class:"cm-scale"}),v=r("<a/>",{href:"javascript:;",title:"Previous",id:"cm-prev"}).text("prev"),w=r("<a/>",{href:"javascript:;",title:"Next",id:"cm-next"}).text("next"),g=r("<a/>",{href:"javascript:;",title:"Press ESC to close",id:"cm-close"}).text("close"),b=900,y=.5625,e=0,x=0,k=0,C="none",j=function(){"number"==typeof window.innerWidth?(x=window.innerWidth,e=window.innerHeight):document.documentElement&&(document.documentElement.clientWidth||document.documentElement.clientHeight)?(x=document.documentElement.clientWidth,e=document.documentElement.clientHeight):document.body&&(document.body.clientWidth||document.body.clientHeight)&&(x=document.body.clientWidth,e=document.body.clientHeight),k=10*Math.round(.9*e/10)};r(window).on("swipeleft",function(){w.trigger("tap")}),r(window).on("swiperight",function(){v.trigger("tap")}),r(document).keydown(function(e){switch(e.which){case 27:t();break;case 37:v.trigger("tap");break;case 38:break;case 39:w.trigger("tap");break;case 40:break;default:return}e.preventDefault()});r.fn.cmOverlay=function(){return null!==l&&l.each(function(){r(this).off()}),(l=this).each(function(t){r(this).on("tap",function(e){e.preventDefault(),n(t)})})}}(jQuery);